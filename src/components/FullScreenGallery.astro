---
import { Image } from 'astro:assets';
import { galleryItems } from '../data/gallery';

// Import images dynamically
const images = import.meta.glob<{ default: ImageMetadata }>('/src/assets/images/*.{png,jpg,jpeg}', { eager: true });
---

<div class="swiper fullscreen-gallery">
  <div class="swiper-wrapper">
    {galleryItems.map((item) => {
      const imagePath = `/src/assets/images/${item.src}`;
      const imageModule = images[imagePath];

      if (!imageModule) {
        throw new Error(`Image not found: ${imagePath}`);
      }

      return (
        <div class="swiper-slide">
          <div class="slide-content">
            <div class="image-container">
              {item.hasPaper ? (
                <div class="paper">
                  <Image
                    src={imageModule.default}
                    alt={item.title}
                    loading="lazy"
                    quality={90}
                    class="gallery-image"
                  />
                </div>
              ) : (
                <Image
                  src={imageModule.default}
                  alt={item.title}
                  loading="lazy"
                  quality={90}
                  class="gallery-image"
                />
              )}
            </div>
            <div class={`description ${item.hasPaper ? 'paper' : ''}`}>
              <h2 class="text-xl font-sans font-bold leading-tight mb-1.5">{item.title}</h2>
              <em class="font-display not-italic text-sm">{item.year}</em>
            </div>
          </div>
        </div>
      );
    })}
  </div>

  <!-- Custom vertical pagination -->
  <div class="swiper-pagination"></div>
</div>

<style>
  .fullscreen-gallery {
    width: 100vw;
    height: 100vh;
    position: relative;
  }

  .swiper-slide {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 5%;
  }

  .slide-content {
    max-width: 90%;
    max-height: 90%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 2rem;
  }

  .image-container {
    max-width: 100%;
    max-height: 70vh;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .gallery-image {
    max-width: 100%;
    max-height: 70vh;
    width: auto;
    height: auto;
    object-fit: contain;
  }

  .description {
    text-align: center;
    padding: 1rem 1.5rem;
    margin-top: 1rem;
  }

  /* Custom vertical pagination styling */
  :global(.swiper-pagination) {
    left: 2rem !important;
    right: auto !important;
    bottom: 2rem !important;
    top: auto !important;
    width: auto !important;
    display: flex !important;
    flex-direction: column !important;
    gap: 0.5rem !important;
  }

  :global(.swiper-pagination-bullet) {
    width: 8px !important;
    height: 8px !important;
    background: rgba(0, 0, 0, 0.3) !important;
    opacity: 1 !important;
    margin: 0 !important;
    border-radius: 4px !important;
    transition: all 0.3s ease !important;
  }

  :global(.swiper-pagination-bullet-active) {
    width: 8px !important;
    height: 24px !important;
    background: rgba(0, 0, 0, 0.8) !important;
    border-radius: 4px !important;
  }

  @media (max-width: 768px) {
    .slide-content {
      max-width: 95%;
      gap: 1rem;
    }

    .image-container {
      max-height: 60vh;
    }

    .gallery-image {
      max-height: 60vh;
    }

    :global(.swiper-pagination) {
      left: 1rem !important;
      bottom: 1rem !important;
    }
  }
</style>

<script>
  import Swiper from 'swiper';
  import { Mousewheel, Pagination, Keyboard } from 'swiper/modules';
  import 'swiper/css';
  import 'swiper/css/pagination';

  // Initialize Swiper
  const swiper = new Swiper('.fullscreen-gallery', {
    modules: [Mousewheel, Pagination, Keyboard],
    direction: 'vertical',
    slidesPerView: 1,
    spaceBetween: 0,
    speed: 800,
    mousewheel: {
      enabled: true,
      sensitivity: 0.5,
      thresholdDelta: 10,
      thresholdTime: 300,
    },
    keyboard: {
      enabled: true,
      onlyInViewport: true,
    },
    pagination: {
      el: '.swiper-pagination',
      clickable: true,
    },
    touchRatio: 1,
    threshold: 10,
    longSwipesRatio: 0.3,
    longSwipesMs: 300,
  });
</script>
